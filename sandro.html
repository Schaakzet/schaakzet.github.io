<html>
  <head>
    <script src="./webcomponents/schaakzet.js"></script>
  </head>

  <body>
    <main>
      <h1-chess></h1-chess>
      <todo-list> Make it a playable board, without opponent color. If check, no castling. Stalemate. </todo-list>

      <label for="enterFEN">enter FEN:</label> <input id="fen" type="text" size="100" style="width: 40em" />
      <br />
      <button onclick="setFEN(fen.value)">Set FEN</button>
      <button onclick="setStart()">Startpositie</button>
      <button onclick="document.querySelector('chess-board').undoMove()">Undo move</button>
      <chess-game>
        <chess-board id="schaak3" fen="r1bqk1nr/pppp1ppp/2n5/4p3/1b2P3/5N2/PPPP1PPP/RNBQKB1R w KQkq -" labels></chess-board>
        <!-- <chess-boards>
          rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - | r3k2r/ppp1bpp1/2nqbn1p/3pp3/3PP2P/2NQBN2/PPP1BPP1/R3K2R w KQkq - |
          r1bqk1nr/pppp1ppp/2n5/2b1p3/4P3/4KN2/PPPP1PPP/RNBQ1B1R w KQkq - | K7/8/8/6Q1/8/8/5R2/7k w - -
        </chess-boards> -->
        <forward-boards id="TESTBOARD" style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 1em"> </forward-boards>
      </chess-game>
      <div id="message">[MESSAGE]</div>
    </main>
    <script>
      //reset to startposition
      function setStart() {
        let chessboard = document.querySelector("chess-board");
        chessboard.clear();
        setFEN("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -");
        document.getElementById("message").innerText = "";
        chessboard.capturedWhitePieces = [];
        chessboard.capturedBlackPieces = [];
      }
    </script>
    <script>
      // define a GLOBAL setFEN function so all inputs can call this function
      window.setFEN = function (fenString) {
        let chessboard = document.querySelector("chess-board");
        chessboard.fen = fenString;
        console.clear();
        document.getElementById("message").innerText = "";
        chessboard.capturedWhitePieces = [];
        chessboard.capturedBlackPieces = [];
      };
      setTimeout(() => {
        let chessboard = document.querySelector("chess-board");
        chessboard.labels = false;

        let clickSquare = "d2";
        setTimeout(() => {
          let piece = chessboard.getPiece(clickSquare);
          piece.click();
          console.log("check check moves", piece.moves);
          let illegalMoves = piece.moves.filter((move, idx) => {
            // let newBoard = document.createElement("chess-board");
            // TESTBOARD.appendChild(newBoard);

            console.log(21);
            TESTBOARD.insertAdjacentHTML("beforeend", `<chess-board id="test${idx}"></chess-board>`);
            let newBoard = TESTBOARD.querySelector(`#test${idx}`);
            console.log(22);
            //setTimeout(() => {
            newBoard.fen = chessboard.fen;
            newBoard.labels = false;
            let piece = newBoard.getPiece(clickSquare);
            console.log(piece);
            piece.movePieceTo(move, false); // move piece without animation
            return CHESS.analysis(newBoard, "checkcheck");
            //}, 100);
          });
          console.error("illegalMoves", illegalMoves);
          //newBoard.getPiece("d2").click();
          //chessboard.play([["d2", "d3"]]);
        }, 100);
      }, 500);
    </script>
  </body>
</html>
